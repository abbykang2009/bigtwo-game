<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Two - 2-3 Player Online</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .game-area { display: none; }
        .card { width: 60px; height: 90px; background-color: white; border: 1px solid #ccc; border-radius: 5px; display: inline-block; margin: 5px; text-align: center; line-height: 90px; font-size: 16px; cursor: pointer; position: relative; box-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
        .card.selected { transform: translateY(-20px); box-shadow: 0 5px 10px rgba(0,0,0,0.2); }
        .card.hearts, .card.diamonds { color: red; }
        .card.spades, .card.clubs { color: black; }
        .card .rank { position: absolute; top: 5px; left: 5px; font-size: 14px; }
        .card .suit { font-size: 24px; }
        .card .rank.bottom { top: auto; left: auto; bottom: 5px; right: 5px; }
        .player-hand { margin-top: 20px; min-height: 120px; border-top: 2px solid #ddd; padding-top: 20px; }
        .opponent-info { margin-bottom: 20px; padding: 10px; background-color: #f9f9f9; border-radius: 5px; display: inline-block; width: 30%; margin-right: 2%; }
        .game-info { margin-bottom: 20px; padding: 10px; background-color: #e9f7ef; border-radius: 5px; }
        .last-played { margin: 20px 0; min-height: 100px; border: 1px dashed #ccc; border-radius: 5px; padding: 10px; }
        button { padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:disabled { background-color: #cccccc; }
        button:hover:not(:disabled) { background-color: #45a049; }
        .lobby { margin-bottom: 20px; }
        .room-info { font-weight: bold; margin: 10px 0; }
        .winner-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .winner-content { background-color: white; padding: 30px; border-radius: 10px; text-align: center; }
        .player-count { margin: 10px 0; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Big Two - 2-3 Player Online</h1>
        
        <div id="setup-area">
            <div id="create-game" class="lobby">
                <h2>Create Game</h2>
                <input type="text" id="player-name-create" placeholder="Your Name">
                <button onclick="createGame()">Create Game</button>
            </div>
            
            <div id="join-game" class="lobby">
                <h2>Join Game</h2>
                <input type="text" id="player-name-join" placeholder="Your Name">
                <input type="text" id="room-id" placeholder="Room ID">
                <button onclick="joinGame()">Join Game</button>
            </div>
        </div>
        
        <div id="waiting-area" style="display: none;">
            <h2>Waiting for players...</h2>
            <div class="room-info">Room ID: <span id="display-room-id"></span></div>
            <div class="player-count">(<span id="player-count">1</span>/3 players, minimum 2 to start)</div>
            <p>Share the Room ID with friends to join the game.</p>
            <div id="player-list"></div>
            <button id="ready-btn" onclick="ready()">Ready</button>
        </div>
        
        <div id="game-area" class="game-area">
            <div id="opponents-container" style="display: flex; justify-content: space-between;"></div>
            
            <div class="game-info">
                <p id="turn-indicator"></p>
            </div>
            
            <div class="last-played">
                <h3>Last Played:</h3>
                <div id="last-played-cards"></div>
            </div>
            
            <div class="player-hand">
                <h3>Your Hand:</h3>
                <div id="hand"></div>
            </div>
            
            <div class="controls">
                <button id="play-btn" onclick="playCards()">Play Selected</button>
                <button id="pass-btn" onclick="passTurn()">Pass</button>
            </div>
        </div>
    </div>

    <div id="winner-screen" class="winner-screen">
        <div class="winner-content">
            <h2 id="winner-message"></h2>
            <div id="scores-display"></div>
            <button onclick="location.reload()">Play Again</button>
        </div>
    </div>

    <script>
        // Initialize Socket.IO connection
        const socket = io("https://bigtwo-game.onrender.com", { 
            transports: ['websocket'] 
        });
        
        let playerId;
        let roomId;
        let selectedCards = [];
        
        // Debugging connection
        socket.on('connect', () => console.log("Connected! Socket ID:", socket.id));
        socket.on('disconnect', () => console.log("Disconnected!"));
        socket.on('connect_error', (err) => console.log("Connection error:", err));

        // Handle room updates
        socket.on('room_update', (data) => {
            const playerList = document.getElementById('player-list');
            playerList.innerHTML = '';
            data.players.forEach(player => {
                const li = document.createElement('li');
                li.textContent = player;
                playerList.appendChild(li);
            });
            document.getElementById('player-count').textContent = data.players.length;
        });

        // Handle errors
        socket.on('error', (data) => {
            alert(data.message);
        });

        function createGame() {
            const playerName = document.getElementById('player-name-create').value;
            if (!playerName) {
                alert('Please enter your name');
                return;
            }
            
            fetch('/create_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ player_name: playerName })
            })
            .then(response => response.json())
            .then(data => {
                roomId = data.room_id;
                playerId = data.player_name; // Using name as ID for simplicity
                
                document.getElementById('setup-area').style.display = 'none';
                document.getElementById('waiting-area').style.display = 'block';
                document.getElementById('display-room-id').textContent = roomId;
                
                // Tell server we're creating a room
                socket.emit('create_room', {
                    username: playerName,
                    room_id: roomId
                });
            })
            .catch(error => console.error('Error:', error));
        }
        
        function joinGame() {
            const playerName = document.getElementById('player-name-join').value;
            const roomIdInput = document.getElementById('room-id').value;
            
            if (!playerName || !roomIdInput) {
                alert('Please enter your name and room ID');
                return;
            }
            
            fetch('/join_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    player_name: playerName,
                    room_id: roomIdInput 
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                
                roomId = roomIdInput;
                playerId = playerName; // Using name as ID for simplicity
                
                document.getElementById('setup-area').style.display = 'none';
                document.getElementById('waiting-area').style.display = 'block';
                document.getElementById('display-room-id').textContent = roomId;
                
                // Tell server we're joining a room
                socket.emit('join_room', {
                    username: playerName,
                    room_id: roomId
                });
            })
            .catch(error => console.error('Error:', error));
        }

        // Basic game functions (simplified)
        function ready() {
            alert("Ready clicked! Game will start when all players are ready.");
        }
        
        function playCards() {
            alert("Play selected cards - will implement later");
        }
        
        function passTurn() {
            alert("Pass turn - will implement later");
        }
    </script>
</body>
</html>
